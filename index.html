<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>GhostChild ‚Äî Neon Trainer (Edge-to-Edge + Side Chat)</title>
<meta name="theme-color" content="#071510" />
<style>
  :root{
    --bg:#071510; --card:#0D2018; --accent:#D3B24C; --neon:#32ff77;
    --text:#E6ECEF; --muted:#94A3B8; --border:#173228;
    --chatW:420px;            /* chat width in landscape */
    --topH:100px;             /* updated by JS to exact header height */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.45 system-ui,Segoe UI,Roboto}

  button{border:0;border-radius:12px;padding:10px 14px;cursor:pointer;background:#0f172a;color:#dce3ea;border:1px solid #1f2937}
  button.primary{background:var(--accent);color:#111;border:none}
  button.neon{background:#112a1b;border:1px solid #1e3a2f}
  button.neon.on{background:#0f2419;border-color:#26c55e;box-shadow:0 0 12px 0 rgba(50,255,119,.35)}
  input,select{width:100%;background:#0b1420;border:1px solid #1f2937;color:#e6ecef;border-radius:12px;padding:10px}

  /* ===== Top bar ===== */
  .app{max-width:none;padding:12px 0 calc(18px + env(safe-area-inset-bottom))}
  .top{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0 12px}
  .brand{display:flex;gap:10px;align-items:center}
  .live{display:flex;gap:8px;align-items:center;background:#0e1b16;border:1px solid var(--border);padding:6px 10px;border-radius:999px}
  .dot{width:8px;height:8px;border-radius:999px;background:#fb3f3f;animation:pulse 1.6s infinite}
  @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(251,63,63,.35)}70%{box-shadow:0 0 0 12px rgba(251,63,63,0)}100%{box-shadow:0 0 0 0 rgba(251,63,63,0)}}

  /* ===== PORTRAIT: video full-bleed on top ===== */
  .videoBleed{width:100vw;margin-left:calc(50% - 50vw)}
  .videoBar{position:relative;background:#000;border:0;border-radius:0;overflow:hidden}
  .videoBox{position:relative;width:100%;aspect-ratio:16/9}
  .videoBox video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scaleX(1)}
  .mirror .videoBox video{transform:scaleX(-1)}
  .hud{position:absolute;left:0;top:0;right:0;pointer-events:none;padding:8px}
  .badge{display:inline-flex;gap:6px;align-items:center;background:rgba(0,0,0,.55);color:#fff;padding:5px 9px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.12);margin-right:6px}
  .badge.gold{background:rgba(211,178,76,.18);border-color:rgba(211,178,76,.45);color:#f6e7b2}

  .controls{display:flex;flex-wrap:wrap;gap:8px;margin:10px 12px}

  /* ===== Chat (shared) ===== */
  .chat{position:relative;background:var(--card);border:1px solid var(--border);border-radius:16px;display:flex;flex-direction:column;overflow:hidden;margin:10px 12px 0}
  .chatHead{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
  .chatRight{display:flex;gap:8px;align-items:center}
  .chatBody{flex:1;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px;scroll-behavior:smooth;max-height:48vh}
  .msg{display:flex;gap:8px;align-items:flex-start;animation:msgIn .22s ease-out}
  @keyframes msgIn{from{transform:translateY(6px);opacity:.15}to{transform:none;opacity:1}}
  .avatar{width:24px;height:24px;border-radius:50%;background:#0b1220;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:12px;color:#bcd;flex:none}
  .bubble{background:#0b1220;border:1px solid #182235;padding:6px 10px;border-radius:12px 12px 12px 6px;max-width:92%;word-break:break-word}
  .name{font-weight:800;margin-right:6px}
  .neonRule{display:flex;align-items:center;gap:10px;color:var(--neon);font-weight:900;letter-spacing:1px;justify-content:center;margin:6px 0}
  .neonRule:before,.neonRule:after{content:"";height:2px;flex:1;background:linear-gradient(90deg,transparent, var(--neon), transparent);filter:drop-shadow(0 0 4px var(--neon))}
  .inputRow{display:flex;gap:8px;padding:10px;border-top:1px solid var(--border)}
  .emojiBar{display:flex;gap:8px;padding:0 10px 10px;border-top:1px solid #152432;background:#0c1726}
  .emojiBtn{font-size:20px;background:#0f172a;border:1px solid #1f2a3a;border-radius:10px;padding:4px 8px}
  #jump{position:absolute;right:10px;bottom:74px;background:#0b1220;border:1px solid var(--border);padding:8px 12px;border-radius:999px;font-size:12px;display:none}

  .footer{margin-top:10px;color:var(--muted);font-size:12px;padding:0 12px}

  /* ===== LANDSCAPE: video LEFT edge-to-edge, chat RIGHT dock ===== */
  @media (orientation:landscape), (min-aspect-ratio:13/9){
    .videoBleed{width:auto;margin-left:0}
    .main{
      display:grid;
      grid-template-columns:minmax(0, calc(100vw - var(--chatW))) var(--chatW);
      gap:0; /* seamless join like Kick */
      align-items:start;
    }
    .leftCol{min-width:0}
    .videoBox{aspect-ratio:auto;height:calc(100dvh - var(--topH))}
    .chat{
      margin:0;
      height:calc(100dvh - var(--topH));
      border-radius:0;
      border-left:1px solid var(--border);
    }
    .chatBody{max-height:none;min-height:0}
    .controls{margin:8px 12px}
  }
  @supports (height:100svh){
    @media (orientation:landscape), (min-aspect-ratio:13/9){
      .videoBox{height:calc(100svh - var(--topH))}
      .chat{height:calc(100svh - var(--topH))}
    }
  }

  /* error toast */
  #err{position:fixed;left:8px;right:8px;bottom:8px;background:#7f1d1d;color:#fee2e2;border:1px solid #ef4444;padding:8px 10px;border-radius:12px;display:none;z-index:5000}
</style>
</head>
<body>
  <div class="app mirror" id="app">
    <div class="top" id="topbar">
      <div class="brand">
        <div style="width:26px;height:26px;border-radius:8px;background:linear-gradient(135deg,#0a120d,#0d2018);display:flex;align-items:center;justify-content:center;border:1px solid var(--border)">üó°Ô∏è</div>
        <div>
          <div style="font-weight:700;letter-spacing:.3px">GhostChild Neon Trainer</div>
          <div style="font-size:12px;color:#94A3B8">Edge-to-edge video ‚Ä¢ side chat in landscape ‚Ä¢ ultra record</div>
        </div>
      </div>
      <div class="live"><div class="dot"></div><div>LIVE (training)</div></div>
    </div>

    <div class="main">
      <!-- VIDEO COLUMN -->
      <div class="leftCol">
        <section class="videoBleed">
          <div class="videoBar">
            <div class="videoBox" id="videoBox">
              <video id="cam" playsinline muted></video>
              <div class="hud">
                <span class="badge">@<span id="handle">ghostchild</span></span>
                <span class="badge gold">üëÅ <span id="viewers">0</span></span>
                <span class="badge">‚ù§Ô∏è <span id="likes">0</span></span>
                <span class="badge">‚è± <span id="clock">00:00</span></span>
              </div>
            </div>
          </div>
        </section>

        <div class="controls">
          <button class="primary" id="startCam">Start Camera (HD)</button>
          <button class="neon" id="hype">Hype ‚ö°</button>
          <button id="recUltra">‚óè Ultra Record (Video+Chat)</button>
          <button id="fsBtn">Fullscreen / Rotate</button>
          <button id="mirrorBtn">Mirror: ON</button>
        </div>
      </div>

      <!-- CHAT COLUMN -->
      <div class="chat" id="chatPanel">
        <div class="chatHead">
          <div style="font-weight:700">Chat</div>
          <div class="chatRight">
            <select id="mood" title="Chat mood">
              <option value="support">Support</option>
              <option value="roast">Roast</option>
              <option value="boo">Boo Squad</option>
              <option value="chaos">Chaos</option>
              <option value="coach">Coach</option>
            </select>
            <button class="neon" id="chatToggle">Chat: OFF</button>
            <button id="clearChat">Clear</button>
          </div>
        </div>
        <div class="chatBody" id="chatBody"></div>
        <div class="neonRule" id="newDivider" style="display:none">NEW</div>
        <button id="jump">‚¨áÔ∏è Jump to latest</button>
        <div class="emojiBar" id="emojiBar"></div>
        <div class="inputRow">
          <input id="myMsg" placeholder="Send a message‚Ä¶" />
          <button id="sendBtn">Send</button>
        </div>
      </div>
    </div>

    <div class="footer">Open with Chrome/Safari (not an in-app browser). iPhone uses Apple‚Äôs native video fullscreen.</div>
  </div>
  <div id="err"></div>

<script>
/* ===== measure top bar so video/chat fill height precisely ===== */
function setTopHeight(){
  const h=document.getElementById('topbar').getBoundingClientRect().height;
  document.documentElement.style.setProperty('--topH', (Math.round(h)+12)+'px');
}
window.addEventListener('load',setTopHeight);
window.addEventListener('resize',setTopHeight);

/* ===== helpers ===== */
const $=s=>document.querySelector(s);
const chatBody=$('#chatBody'), cam=$('#cam'), err=$('#err'), newDiv=$('#newDivider');
const viewersEl=$('#viewers'), likesEl=$('#likes'), clockEl=$('#clock');
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const pad2=n=>String(n).padStart(2,'0');
const isiOS=/iPad|iPhone|iPod/.test(navigator.userAgent)||(navigator.platform==='MacIntel'&&navigator.maxTouchPoints>1);
const colorFor=n=>{let h=0;for(let i=0;i<n.length;i++)h=(h*31+n.charCodeAt(i))%360;return `hsl(${h} 75% 70%)`};
const escapeHTML=s=>String(s).replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
function showErr(t){err.textContent=t; err.style.display='block'; setTimeout(()=>err.style.display='none', 6000)}

/* emoji bar */
;['üòÇ','üî•','‚ö°','üò≠','üëÄ','üíÄ','üí™','üèÜ','üöÄ','‚ù§Ô∏è','üòà','üåä'].forEach(e=>{
  const b=document.createElement('button'); b.className='emojiBtn'; b.textContent=e;
  b.onclick=()=>{ const i=$('#myMsg'); i.value=(i.value+' '+e).trim(); i.focus(); };
  $('#emojiBar').appendChild(b);
});

/* chat renderer + NEW divider */
let autoScroll=true, unseen=0;
chatBody.addEventListener('scroll',()=>{
  autoScroll = chatBody.scrollHeight - chatBody.scrollTop - chatBody.clientHeight < 40;
  $('#jump').style.display = autoScroll ? 'none' : 'block';
  if(autoScroll){ unseen=0; newDiv.style.display='none'; }
});
$('#jump').onclick=()=>{ autoScroll=true; chatBody.scrollTop=chatBody.scrollHeight; unseen=0; newDiv.style.display='none'; };

function pushMsg(name,text){
  const row=document.createElement('div'); row.className='msg';
  const av=document.createElement('div'); av.className='avatar'; av.textContent=name.slice(0,2).toUpperCase();
  const bubble=document.createElement('div'); bubble.className='bubble';
  bubble.innerHTML=`<span class="name" style="color:${colorFor(name)}">${escapeHTML(name)}</span>${escapeHTML(text)}`;
  row.appendChild(av); row.appendChild(bubble); chatBody.appendChild(row);
  if(autoScroll){ chatBody.scrollTop=chatBody.scrollHeight } else { unseen++; newDiv.style.display='flex'; }
}
$('#sendBtn').onclick=()=>{ const v=$('#myMsg').value.trim(); if(!v) return; pushMsg('You',v); $('#myMsg').value=''; };
$('#clearChat').onclick=()=>{ chatBody.innerHTML=''; unseen=0; newDiv.style.display='none'; };

/* moods + bots */
const MOODS={
  support:['W stream energy üî•','Mic sounds clean','Clippers awake ‚úÇÔ∏è','We locked in','Chef talk','Respect from the islands üåä'],
  roast:['Mid take üíÄ','Cook harder','Chat wants receipts not vibes','That was a re-run','Ratio? maybe üò≠'],
  boo:['BOOOOO üí®','L take ‚ùå','Pack it up','Scroll ‚è≠Ô∏è','Bring heat or mute'],
  chaos:['Skibidi rizzless sigma üò≠','NPC arc unlocked ü§ñ','Cook or get cooked üç≥','Certified cringe speedrun'],
  coach:['Give the 3 rules','First step right now?','Numbers or it didn‚Äôt happen','Where does it fail?']
};
const pool=()=>MOODS[$('#mood').value]||MOODS.support;
function choice(a){ return a[Math.floor(Math.random()*a.length)] }
function genName(){ const F=['Kai','Mika','Rae','Luca','Noa','Sage','Aria','Zee','Tane','Mali','Jax','Tori','Koa','Rook','Navi','Kane','Dax','Nova','Sefa','Lani']; const L=['Fiji','PNG','Ghost','Vault','Edge','Storm','Reign','Wave','Raptor','Beta','Sigma']; return choice(F)+' '+choice(L) }

let botsOn=false, botTimer=null;
function scheduleBot(){ clearTimeout(botTimer); botTimer=setTimeout(()=>{ if(!botsOn) return; pushMsg(genName(), choice(pool())); scheduleBot(); }, rnd(650,1200)); }
$('#chatToggle').onclick=()=>{ botsOn=!botsOn; const b=$('#chatToggle'); b.textContent=botsOn?'Chat: ON':'Chat: OFF'; b.classList.toggle('on',botsOn); if(botsOn) scheduleBot(); };

/* hype */
$('#hype').onclick=()=>{ $('#hype').classList.add('on'); setTimeout(()=>$('#hype').classList.remove('on'),900); for(let i=0;i<14;i++) setTimeout(()=>floatEmoji(choice(['üî•','‚ö°','üöÄ','üèÜ','üò§','‚ù§Ô∏è'])), i*70); };
function floatEmoji(e){ const el=document.createElement('div'); el.textContent=e; el.style.position='fixed'; el.style.left=(6+Math.random()*88)+'%'; el.style.bottom='8%'; el.style.fontSize='22px'; el.style.pointerEvents='none'; el.style.filter='drop-shadow(0 0 6px rgba(255,255,255,.35))'; document.body.appendChild(el); el.animate([{transform:'translateY(0) scale(1)',opacity:.95},{transform:'translateY(-180px) scale(1.3)',opacity:0}],{duration:2200,easing:'ease-out'}).onfinish=()=>el.remove(); }

/* camera (hardened) */
async function startCamera(){
  const tries=[{w:1920,h:1080,fps:60},{w:1920,h:1080,fps:30},{w:1280,h:720,fps:30}];
  for(const t of tries){
    try{
      const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user',width:{ideal:t.w},height:{ideal:t.h},frameRate:{ideal:t.fps,max:t.fps}},audio:true});
      cam.srcObject=s; cam.muted=true; cam.playsInline=true; await cam.play();
      $('#startCam').textContent=`Camera On (${t.h}p@${t.fps})`; $('#startCam').disabled=true; return;
    }catch(e){ if(t===tries[tries.length-1]) showErr(`Camera failed: ${e.name||''} ${e.message||''}`); }
  }
}
$('#startCam').onclick=startCamera;

/* counters + clock */
let likes=0, viewers=0, t0=Date.now();
setInterval(()=>{ viewers=Math.max(0,(viewers||37)+rnd(-2,5)); viewersEl.textContent=viewers; if(Math.random()<0.35){ likes++; likesEl.textContent=likes } },1100);
setInterval(()=>{ const s=Math.floor((Date.now()-t0)/1000); clockEl.textContent=`${pad2(Math.floor(s/60))}:${pad2(s%60)}` },1000);

/* fullscreen + mirror */
const root=document.documentElement;
async function goFS(){ if(isiOS){ cam.webkitEnterFullscreen?.(); return } try{ await root.requestFullscreen(); await screen.orientation?.lock?.('landscape').catch(()=>{}); document.body.classList.add('theater') }catch{ document.body.classList.toggle('theater') } }
async function exitFS(){ if(isiOS){ cam.webkitExitFullscreen?.(); return } if(document.fullscreenElement){ await document.exitFullscreen(); document.body.classList.remove('theater') } else document.body.classList.remove('theater') }
let fs=false; $('#fsBtn').onclick=()=>{ fs?exitFS():goFS(); fs=!fs; };
let mirrorOn=true; $('#mirrorBtn').onclick=()=>{ mirrorOn=!mirrorOn; $('#mirrorBtn').textContent=`Mirror: ${mirrorOn?'ON':'OFF'}`; document.getElementById('app').classList.toggle('mirror',mirrorOn) };

/* Ultra record (video + HUD + recent chat) */
let rec=null, chunks=[], rafId=null;
function preferMime(){
  if(MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) return 'video/webm;codecs=vp9';
  if(MediaRecorder.isTypeSupported('video/webm;codecs=vp8')) return 'video/webm;codecs=vp8';
  if(MediaRecorder.isTypeSupported('video/mp4;codecs=h264')) return 'video/mp4;codecs=h264';
  return '';
}
$('#recUltra').onclick=async()=>{
  if(rec){ if(rec.state!=='inactive') rec.stop(); return }
  if(!cam.srcObject){ await startCamera(); if(!cam.srcObject) return showErr('Start the camera first.') }

  const v=cam, cw=v.videoWidth||1280, ch=v.videoHeight||720;
  const canvas=document.createElement('canvas'); canvas.width=cw; canvas.height=ch;
  const ctx=canvas.getContext('2d');

  const wrap=(ctx,t,maxW)=>{ const w=String(t).split(/\s+/), out=[]; let line=''; for(const word of w){ const test=line?line+' '+word:word; if(ctx.measureText(test).width>maxW){ if(line) out.push(line); line=word } else line=test } if(line) out.push(line); return out };

  const draw=()=>{
    ctx.drawImage(v,0,0,cw,ch);
    // HUD
    ctx.fillStyle='rgba(0,0,0,.45)'; ctx.fillRect(16,16,380,80);
    ctx.fillStyle='#F2F5F7'; ctx.font='26px system-ui'; ctx.fillText('@ghostchild',28,48);
    ctx.fillStyle='#32ff77'; ctx.font='18px system-ui';
    ctx.fillText(`üëÅ ${viewers}   ‚ù§Ô∏è ${likes}   ‚è± ${$('#clock').textContent}`,28,76);
    // last 10 chat lines
    const lines=[...document.querySelectorAll('.bubble')].slice(-10).map(n=>n.textContent);
    const x=cw-460, w=440; let y=28;
    ctx.fillStyle='rgba(0,0,0,.42)'; ctx.fillRect(x-8,16,w+16,lines.length*40+16);
    ctx.fillStyle='#e6ecef'; ctx.font='17px system-ui';
    for(const L of lines){ for(const r of wrap(ctx,L,w)){ ctx.fillText(r,x,y); y+=20 } y+=8 }
    if('requestVideoFrameCallback' in v) v.requestVideoFrameCallback(draw); else rafId=requestAnimationFrame(draw);
  };
  draw();

  const fps=(v.getVideoTracks()[0]?.getSettings()?.frameRate||30)>=60?60:30;
  const out=canvas.captureStream(fps);
  v.srcObject.getAudioTracks().forEach(t=> out.addTrack(t));

  const mime=preferMime();
  const opts=mime?{mimeType:mime,videoBitsPerSecond:12_000_000,audioBitsPerSecond:192_000}:{videoBitsPerSecond:12_000_000,audioBitsPerSecond:192_000};
  try{ rec=new MediaRecorder(out,opts) }catch(e){ try{ rec=new MediaRecorder(out) }catch{ return showErr('Recording not supported here.') } }
  chunks=[]; rec.ondataavailable=e=>{ if(e.data.size) chunks.push(e.data) };
  rec.onstop=()=>{ const type=mime||'video/webm'; const blob=new Blob(chunks,{type}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`ghost_ultra_${Date.now()}.${type.includes('mp4')?'mp4':'webm'}`; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); $('#recUltra').textContent='‚óè Ultra Record (Video+Chat)'; if(rafId) cancelAnimationFrame(rafId); rec=null; chunks=[] };
  rec.start(150); $('#recUltra').textContent='‚ñ† Stop Recording';
};
</script>
</body>
</html>
